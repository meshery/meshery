name: Build and Preview Docs
on:
  pull_request:
    branches: [ master ]
    types: [opened, synchronize, reopened]
    paths:
      - '!**'
      - 'docs-new/**'
      
jobs:
  trigger-docs-new-preview:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@master
        with:
          persist-credentials: false
          submodules: true
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: docs-new/package-lock.json

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: '0.148.1'
          extended: true

      - name: Install dart-sass
        run: |
          sudo snap install dart-sass

      - name: Install dependencies
        run: |
          cd docs-new
          npm ci

      - name: Build Hugo site
        run: |
          cd docs-new
          hugo --cleanDestinationDir -e production -DFE --minify --baseURL "/"

      - name: Zip Site
        run: |
          cd docs-new/public
          zip -r ../../docs-new-site.zip .
          cd ../..

      - name: Upload files
        uses: actions/upload-artifact@v4
        with:
          name: docs-new-site
          path: ./docs-new-site.zip
          retention-days: 1

      - name: Trigger preview workflow
        run: echo "triggering preview workflow"
