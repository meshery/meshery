id: 21e0c2be-8266-4d3d-8622-8f705e12629b
name: Tyk Operator Helm Chart
schemaVersion: designs.meshery.io/v1beta1
version: 0.0.1
metadata:
  description: "Tyk Operator for Kubernetes - A Helm chart for deploying Tyk API Gateway Operator"
  source: "helm"
  chart:
    name: "tyk-operator"
    version: "1.0.0"
    repository: "https://github.com/TykTechnologies/tyk-operator"
  labels:
    helm: "true"
    operator: "true"
    api-gateway: "true"
    tyk: "true"
components:
  - id: tyk-operator-deployment
    name: Tyk Operator Deployment
    type: Deployment
    namespace: tyk-operator-system
    version: apps/v1
    model: kubernetes
    configuration:
      spec:
        replicas: 1
        selector:
          matchLabels:
            app: tyk-operator
            component: controller
        template:
          metadata:
            labels:
              app: tyk-operator
              component: controller
          spec:
            containers:
            - name: manager
              image: tyk/tyk-operator:latest
              ports:
              - containerPort: 8080
                name: metrics
                protocol: TCP
              resources:
                limits:
                  cpu: 500m
                  memory: 128Mi
                requests:
                  cpu: 100m
                  memory: 64Mi
            serviceAccountName: tyk-operator-controller-manager
    traits:
      position:
        x: 200
        y: 200
  
  - id: tyk-operator-service-account
    name: Tyk Operator Service Account
    type: ServiceAccount
    namespace: tyk-operator-system
    version: v1
    model: kubernetes
    configuration:
      metadata:
        name: tyk-operator-controller-manager
    traits:
      position:
        x: 100
        y: 100

  - id: tyk-operator-cluster-role
    name: Tyk Operator Cluster Role
    type: ClusterRole
    version: rbac.authorization.k8s.io/v1
    model: kubernetes
    configuration:
      metadata:
        name: tyk-operator-manager-role
      rules:
      - apiGroups: ["tyk.tyk.io"]
        resources: ["*"]
        verbs: ["*"]
      - apiGroups: ["apps"]
        resources: ["deployments", "services"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
      - apiGroups: [""]
        resources: ["configmaps", "secrets", "services"]
        verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    traits:
      position:
        x: 300
        y: 100

  - id: tyk-operator-cluster-role-binding
    name: Tyk Operator Cluster Role Binding
    type: ClusterRoleBinding
    version: rbac.authorization.k8s.io/v1
    model: kubernetes
    configuration:
      metadata:
        name: tyk-operator-manager-rolebinding
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: tyk-operator-manager-role
      subjects:
      - kind: ServiceAccount
        name: tyk-operator-controller-manager
        namespace: tyk-operator-system
    traits:
      position:
        x: 400
        y: 100

  - id: tyk-operator-namespace
    name: Tyk Operator Namespace
    type: Namespace
    version: v1
    model: kubernetes
    configuration:
      metadata:
        name: tyk-operator-system
    traits:
      position:
        x: 50
        y: 50

relationships:
  - id: deployment-serviceaccount-relationship
    type: binding
    subType: permission
    source: tyk-operator-deployment
    target: tyk-operator-service-account
    
  - id: serviceaccount-clusterrolebinding-relationship
    type: binding
    subType: permission
    source: tyk-operator-service-account
    target: tyk-operator-cluster-role-binding
    
  - id: clusterrole-clusterrolebinding-relationship
    type: binding
    subType: permission
    source: tyk-operator-cluster-role
    target: tyk-operator-cluster-role-binding
    
  - id: namespace-deployment-relationship
    type: parent
    subType: inventory
    source: tyk-operator-namespace
    target: tyk-operator-deployment