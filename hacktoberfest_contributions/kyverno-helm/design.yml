name: Kyverno Policy Engine
version: 0.0.1
services:
  kyverno-admission-controller:
    name: kyverno-admission-controller
    type: Deployment
    apiVersion: apps/v1
    namespace: kyverno
    model: kubernetes
    settings:
      spec:
        replicas: 3
        selector:
          matchLabels:
            app.kubernetes.io/name: kyverno
            app.kubernetes.io/component: admission-controller
        template:
          metadata:
            labels:
              app.kubernetes.io/name: kyverno
              app.kubernetes.io/component: admission-controller
              app.kubernetes.io/version: v1.29.0
          spec:
            containers:
            - name: kyverno
              image: ghcr.io/kyverno/kyverno:v1.29.0
              ports:
              - containerPort: 9443
                name: https
                protocol: TCP
              - containerPort: 8000
                name: metrics
                protocol: TCP
              env:
              - name: INIT_CONFIG
                value: kyverno
              - name: METRICS_CONFIG
                value: kyverno-metrics
              - name: KYVERNO_NAMESPACE
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.namespace
              volumeMounts:
              - name: config
                mountPath: /etc/config
                readOnly: true
              - name: metrics-config
                mountPath: /etc/metrics
                readOnly: true
              livenessProbe:
                httpGet:
                  path: /health/liveness
                  port: 9443
                  scheme: HTTPS
                initialDelaySeconds: 15
                periodSeconds: 30
                timeoutSeconds: 5
                failureThreshold: 2
                successThreshold: 1
              readinessProbe:
                httpGet:
                  path: /health/readiness
                  port: 9443
                  scheme: HTTPS
                initialDelaySeconds: 5
                periodSeconds: 10
                timeoutSeconds: 5
                failureThreshold: 6
                successThreshold: 1
              resources:
                limits:
                  memory: 512Mi
                requests:
                  cpu: 100m
                  memory: 128Mi
              securityContext:
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                  - ALL
                privileged: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
                seccompProfile:
                  type: RuntimeDefault
            volumes:
            - name: config
              configMap:
                name: kyverno
            - name: metrics-config
              configMap:
                name: kyverno-metrics
            serviceAccountName: kyverno-admission-controller
    traits:
      meshmap:
        edges: []
        id: 8f3c5b2a-9e1d-4a7c-b8f2-3d5e6a7b8c9d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 70
          posY: 70

  kyverno-background-controller:
    name: kyverno-background-controller
    type: Deployment
    apiVersion: apps/v1
    namespace: kyverno
    model: kubernetes
    settings:
      spec:
        replicas: 2
        selector:
          matchLabels:
            app.kubernetes.io/name: kyverno
            app.kubernetes.io/component: background-controller
        template:
          metadata:
            labels:
              app.kubernetes.io/name: kyverno
              app.kubernetes.io/component: background-controller
              app.kubernetes.io/version: v1.29.0
          spec:
            containers:
            - name: kyverno
              image: ghcr.io/kyverno/background-controller:v1.29.0
              ports:
              - containerPort: 8000
                name: metrics
                protocol: TCP
              resources:
                limits:
                  memory: 256Mi
                requests:
                  cpu: 50m
                  memory: 64Mi
              securityContext:
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                  - ALL
                privileged: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
            serviceAccountName: kyverno-background-controller
    traits:
      meshmap:
        edges: []
        id: 7e2d4c1b-8f3e-4b6a-a9c1-2d3e4f5a6b7c
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 250
          posY: 70

  kyverno-cleanup-controller:
    name: kyverno-cleanup-controller
    type: Deployment
    apiVersion: apps/v1
    namespace: kyverno
    model: kubernetes
    settings:
      spec:
        replicas: 1
        selector:
          matchLabels:
            app.kubernetes.io/name: kyverno
            app.kubernetes.io/component: cleanup-controller
        template:
          metadata:
            labels:
              app.kubernetes.io/name: kyverno
              app.kubernetes.io/component: cleanup-controller
              app.kubernetes.io/version: v1.29.0
          spec:
            containers:
            - name: kyverno
              image: ghcr.io/kyverno/cleanup-controller:v1.29.0
              ports:
              - containerPort: 8000
                name: metrics
                protocol: TCP
              resources:
                limits:
                  memory: 128Mi
                requests:
                  cpu: 25m
                  memory: 32Mi
              securityContext:
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                  - ALL
                privileged: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
            serviceAccountName: kyverno-cleanup-controller
    traits:
      meshmap:
        edges: []
        id: 6d1c3b2a-7e4f-5a6b-b8c9-1d2e3f4a5b6c
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 430
          posY: 70

  kyverno-service:
    name: kyverno-service
    type: Service
    apiVersion: v1
    namespace: kyverno
    model: kubernetes
    settings:
      spec:
        type: ClusterIP
        selector:
          app.kubernetes.io/name: kyverno
          app.kubernetes.io/component: admission-controller
        ports:
        - name: https
          port: 443
          targetPort: 9443
          protocol: TCP
    traits:
      meshmap:
        edges: []
        id: 5c2b4a3d-6e7f-8a9b-c1d2-3e4f5a6b7c8d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 70
          posY: 250

  kyverno-metrics-service:
    name: kyverno-metrics-service
    type: Service
    apiVersion: v1
    namespace: kyverno
    model: kubernetes
    settings:
      spec:
        type: ClusterIP
        selector:
          app.kubernetes.io/name: kyverno
        ports:
        - name: metrics
          port: 8000
          targetPort: 8000
          protocol: TCP
    traits:
      meshmap:
        edges: []
        id: 4b3a5c2d-7e8f-9a1b-c2d3-4e5f6a7b8c9d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 250
          posY: 250

  kyverno-config:
    name: kyverno
    type: ConfigMap
    apiVersion: v1
    namespace: kyverno
    model: kubernetes
    settings:
      data:
        webhooks: |-
          namespaceSelector:
            matchExpressions:
            - key: kubernetes.io/metadata.name
              operator: NotIn
              values:
              - kube-system
              - kyverno
    traits:
      meshmap:
        edges: []
        id: 3a4b5c6d-8e9f-1a2b-c3d4-5e6f7a8b9c1d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 70
          posY: 430

  kyverno-metrics-config:
    name: kyverno-metrics
    type: ConfigMap
    apiVersion: v1
    namespace: kyverno
    model: kubernetes
    settings:
      data:
        namespaces: '{"include":[],"exclude":["kube-system","kyverno"]}'
    traits:
      meshmap:
        edges: []
        id: 2a3b4c5d-9e1f-2a3b-c4d5-6e7f8a9b1c2d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 250
          posY: 430

  kyverno-admission-sa:
    name: kyverno-admission-controller
    type: ServiceAccount
    apiVersion: v1
    namespace: kyverno
    model: kubernetes
    settings: {}
    traits:
      meshmap:
        edges: []
        id: 1a2b3c4d-1e2f-3a4b-c5d6-7e8f9a1b2c3d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 430
          posY: 250

  kyverno-background-sa:
    name: kyverno-background-controller
    type: ServiceAccount
    apiVersion: v1
    namespace: kyverno
    model: kubernetes
    settings: {}
    traits:
      meshmap:
        edges: []
        id: 9a1b2c3d-4e5f-6a7b-c8d9-1e2f3a4b5c6d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 610
          posY: 250

  kyverno-cleanup-sa:
    name: kyverno-cleanup-controller
    type: ServiceAccount
    apiVersion: v1
    namespace: kyverno
    model: kubernetes
    settings: {}
    traits:
      meshmap:
        edges: []
        id: 8a9b1c2d-3e4f-5a6b-c7d8-9e1f2a3b4c5d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 430
          posY: 430

  kyverno-cluster-role:
    name: kyverno
    type: ClusterRole
    apiVersion: rbac.authorization.k8s.io/v1
    model: kubernetes
    settings:
      rules:
      - apiGroups: [""]
        resources: [events, configmaps]
        verbs: [create, update, patch, delete]
      - apiGroups: [""]
        resources: [pods, namespaces]
        verbs: [get, list, watch]
      - apiGroups: [apps]
        resources: [deployments, replicasets, statefulsets, daemonsets]
        verbs: [get, list, watch]
      - apiGroups: [kyverno.io]
        resources: [policies, clusterpolicies, policyreports, clusterpolicyreports, updaterequests, backgroundscanreports, clusterbackgroundscanreports]
        verbs: [get, list, watch, create, update, patch, delete]
      - apiGroups: [wgpolicyk8s.io]
        resources: [policyreports, clusterpolicyreports]
        verbs: [get, list, watch, create, update, patch, delete]
      - apiGroups: [admissionregistration.k8s.io]
        resources: [validatingwebhookconfigurations, mutatingwebhookconfigurations]
        verbs: [create, update, delete, get, list, watch]
    traits:
      meshmap:
        edges: []
        id: 7a8b9c1d-2e3f-4a5b-c6d7-8e9f1a2b3c4d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: false
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 610
          posY: 70

  kyverno-cluster-role-binding:
    name: kyverno
    type: ClusterRoleBinding
    apiVersion: rbac.authorization.k8s.io/v1
    model: kubernetes
    settings:
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: kyverno
      subjects:
      - kind: ServiceAccount
        name: kyverno-admission-controller
        namespace: kyverno
      - kind: ServiceAccount
        name: kyverno-background-controller
        namespace: kyverno
      - kind: ServiceAccount
        name: kyverno-cleanup-controller
        namespace: kyverno
    traits:
      meshmap:
        edges: []
        id: 6a7b8c9d-1e2f-3a4b-c5d6-7e8f9a1b2c3d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: false
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 610
          posY: 430

  kyverno-namespace:
    name: kyverno
    type: Namespace
    apiVersion: v1
    model: kubernetes
    settings:
      metadata:
        labels:
          app.kubernetes.io/name: kyverno
          pod-security.kubernetes.io/enforce: privileged
    traits:
      meshmap:
        edges: []
        id: 5a6b7c8d-9e1f-2a3b-c4d5-6e7f8a9b1c2d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: false
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 250
          posY: 610

  kyverno-pdb:
    name: kyverno-admission
    type: PodDisruptionBudget
    apiVersion: policy/v1
    namespace: kyverno
    model: kubernetes
    settings:
      spec:
        minAvailable: 2
        selector:
          matchLabels:
            app.kubernetes.io/name: kyverno
            app.kubernetes.io/component: admission-controller
    traits:
      meshmap:
        edges: []
        id: 4a5b6c7d-8e9f-1a2b-c3d4-5e6f7a8b9c1d
        meshmodel-metadata:
          genealogy: ""
          isCustomResource: false
          isNamespaced: true
          logoURL: https://raw.githubusercontent.com/cncf/artwork/master/projects/kyverno/icon/color/kyverno-icon-color.svg
          model: kubernetes
          modelDisplayName: Kubernetes
          publishedVersion: 0.7.2
        position:
          posX: 70
          posY: 610

relationships:
  - selectors:
    - from:
        kind: Service
        model: kubernetes
        match:
          name: kyverno-service
    - to:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-admission-controller
    type: network
  - selectors:
    - from:
        kind: Service  
        model: kubernetes
        match:
          name: kyverno-metrics-service
    - to:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-admission-controller
    type: network
  - selectors:
    - from:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-admission-controller
    - to:
        kind: ServiceAccount
        model: kubernetes
        match:
          name: kyverno-admission-controller
    type: binding
  - selectors:
    - from:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-background-controller
    - to:
        kind: ServiceAccount
        model: kubernetes
        match:
          name: kyverno-background-controller
    type: binding
  - selectors:
    - from:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-cleanup-controller
    - to:
        kind: ServiceAccount
        model: kubernetes
        match:
          name: kyverno-cleanup-controller
    type: binding
  - selectors:
    - from:
        kind: ClusterRoleBinding
        model: kubernetes
        match:
          name: kyverno
    - to:
        kind: ClusterRole
        model: kubernetes
        match:
          name: kyverno
    type: permission
  - selectors:
    - from:
        kind: ClusterRoleBinding
        model: kubernetes
        match:
          name: kyverno
    - to:
        kind: ServiceAccount
        model: kubernetes
        match:
          name: kyverno-admission-controller
    type: permission
  - selectors:
    - from:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-admission-controller
    - to:
        kind: ConfigMap
        model: kubernetes
        match:
          name: kyverno
    type: mount
  - selectors:
    - from:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-admission-controller
    - to:
        kind: ConfigMap
        model: kubernetes
        match:
          name: kyverno-metrics
    type: mount
  - selectors:
    - from:
        kind: PodDisruptionBudget
        model: kubernetes
        match:
          name: kyverno-admission
    - to:
        kind: Deployment
        model: kubernetes
        match:
          name: kyverno-admission-controller
    type: policy
