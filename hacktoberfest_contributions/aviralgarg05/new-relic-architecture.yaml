name: New Relic Architecture
version: 0.0.1
services:
  New Relic APM:
    annotations:
      meshery/component-type: observability
    type: NewRelicAPM
    namespace: observability
    settings:
      monitoring:
        application-performance: enabled
        distributed-tracing: enabled
        error-tracking: enabled
        transaction-tracing: enabled
    traits:
      meshmap:
        edges: []
        id: c5a7e8d4-9b2c-4f3a-8e1d-6f4b7a9c2e5d
        meshmodel-metadata:
          capabilities: |
            - Application Performance Monitoring
            - Distributed Tracing
            - Error Analytics
            - Transaction Tracing
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: round-rectangle
          styleOverrides: ""
          subCategory: Observability
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 170
          posY: 90
        whiteboardData:
          style:
            z-index: 3

  Application Server:
    annotations:
      meshery/component-type: core
    type: Deployment
    namespace: default
    settings:
      spec:
        replicas: 3
        selector:
          match-labels:
            app: web-application
        template:
          metadata:
            labels:
              app: web-application
          spec:
            containers:
            - name: app
              image: myapp:v1.0.0
              ports:
              - container-port: 8080
              securityContext:
                allowPrivilegeEscalation: false
                runAsNonRoot: true
                capabilities:
                  drop:
                  - ALL
              env:
              - name: NEW_RELIC_LICENSE_KEY
                value-from:
                  secret-key-ref:
                    name: newrelic-secret
                    key: license-key
              - name: NEW_RELIC_APP_NAME
                value: "Web Application"
    traits:
      meshmap:
        edges:
        - from: c5a7e8d4-9b2c-4f3a-8e1d-6f4b7a9c2e5d
          to: a1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p
        id: a1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p
        meshmodel-metadata:
          capabilities: ""
          genealogy: parent
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: round-pentagon
          styleOverrides: '{"background-color":"#326CE5","border-color":"#326CE5"}'
          subCategory: Workload
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 170
          posY: 210
        whiteboardData:
          style:
            z-index: 4

  New Relic Infrastructure Agent:
    annotations:
      meshery/component-type: observability
    type: DaemonSet
    namespace: observability
    settings:
      spec:
        selector:
          match-labels:
            app: newrelic-infrastructure
        template:
          metadata:
            labels:
              app: newrelic-infrastructure
          spec:
            containers:
            - name: newrelic-infrastructure
              image: newrelic/infrastructure:1.48.1
              securityContext:
                privileged: true
              env:
              - name: NRIA_LICENSE_KEY
                value-from:
                  secret-key-ref:
                    name: newrelic-secret
                    key: license-key
              - name: NRIA_VERBOSE
                value: "1"
              volume-mounts:
              - name: host-root
                mount-path: /host
                read-only: true
            volumes:
            - name: host-root
              host-path:
                path: /
    traits:
      meshmap:
        edges:
        - from: c5a7e8d4-9b2c-4f3a-8e1d-6f4b7a9c2e5d
          to: b2c3d4e5-6f7g-8h9i-0j1k-2l3m4n5o6p7q
        id: b2c3d4e5-6f7g-8h9i-0j1k-2l3m4n5o6p7q
        meshmodel-metadata:
          capabilities: ""
          genealogy: parent
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: hexagon
          styleOverrides: ""
          subCategory: Monitoring
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 50
          posY: 210
        whiteboardData:
          style:
            z-index: 5

  Database:
    annotations:
      meshery/component-type: data
    type: StatefulSet
    namespace: default
    settings:
      spec:
        replicas: 1
        selector:
          match-labels:
            app: postgres
        service-name: postgres
        template:
          metadata:
            labels:
              app: postgres
          spec:
            containers:
            - name: postgres
              image: postgres:14
              ports:
              - container-port: 5432
              securityContext:
                allowPrivilegeEscalation: false
                runAsNonRoot: true
                capabilities:
                  drop:
                  - ALL
              env:
              - name: POSTGRES_DB
                value: myapp
              - name: POSTGRES_PASSWORD
                value-from:
                  secret-key-ref:
                    name: postgres-secret
                    key: password
    traits:
      meshmap:
        edges:
        - from: a1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p
          to: d4e5f6g7-8h9i-0j1k-2l3m-4n5o6p7q8r9s
        id: d4e5f6g7-8h9i-0j1k-2l3m-4n5o6p7q8r9s
        meshmodel-metadata:
          capabilities: ""
          genealogy: parent
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: cylinder
          styleOverrides: '{"background-color":"#336791"}'
          subCategory: Database
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 170
          posY: 330
        whiteboardData:
          style:
            z-index: 6

  New Relic Kubernetes Integration:
    annotations:
      meshery/component-type: observability
    type: Deployment
    namespace: observability
    settings:
      spec:
        replicas: 1
        selector:
          match-labels:
            app: newrelic-kubernetes
        template:
          metadata:
            labels:
              app: newrelic-kubernetes
          spec:
            service-account-name: newrelic-kubernetes
            containers:
            - name: newrelic-kubernetes
              image: newrelic/infrastructure-k8s:3.8.0
              env:
              - name: NRIA_LICENSE_KEY
                value-from:
                  secret-key-ref:
                    name: newrelic-secret
                    key: license-key
              - name: CLUSTER_NAME
                value: "production-cluster"
    traits:
      meshmap:
        edges:
        - from: c5a7e8d4-9b2c-4f3a-8e1d-6f4b7a9c2e5d
          to: f6g7h8i9-0j1k-2l3m-4n5o-6p7q8r9s0t1u
        id: f6g7h8i9-0j1k-2l3m-4n5o-6p7q8r9s0t1u
        meshmodel-metadata:
          capabilities: |
            - Kubernetes Cluster Monitoring
            - Pod and Container Metrics
            - Event Tracking
            - Control Plane Monitoring
          genealogy: parent
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: round-rectangle
          styleOverrides: ""
          subCategory: Kubernetes Monitoring
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 50
          posY: 90
        whiteboardData:
          style:
            z-index: 8

  Load Balancer:
    annotations:
      meshery/component-type: networking
    type: Service
    namespace: default
    settings:
      spec:
        type: LoadBalancer
        ports:
        - port: 80
          target-port: 8080
          protocol: TCP
        selector:
          app: web-application
    traits:
      meshmap:
        edges:
        - from: g7h8i9j0-1k2l-3m4n-5o6p-7q8r9s0t1u2v
          to: a1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p
        id: g7h8i9j0-1k2l-3m4n-5o6p-7q8r9s0t1u2v
        meshmodel-metadata:
          capabilities: ""
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: round-triangle
          styleOverrides: ""
          subCategory: Networking
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 170
          posY: 10
        whiteboardData:
          style:
            z-index: 2

  New Relic Kubernetes ServiceAccount:
    annotations:
      meshery/component-type: configuration
    type: ServiceAccount
    namespace: observability
    settings:
      metadata:
        name: newrelic-kubernetes
    traits:
      meshmap:
        edges: []
        id: sa-1a2b3c4d-5e6f-7g8h-9i0j-1k2l3m4n5o6p
        meshmodel-metadata:
          capabilities: ""
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: rectangle
          styleOverrides: '{"border-style":"dashed"}'
          subCategory: Security
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 390
          posY: 170
        whiteboardData:
          style:
            z-index: 10

  New Relic Kubernetes ClusterRole:
    annotations:
      meshery/component-type: configuration
    type: ClusterRole
    namespace: ""
    settings:
      metadata:
        name: newrelic-kubernetes
      rules:
      - api-groups: [""]
        resources:
        - nodes
        - nodes/metrics
        - nodes/stats
        - nodes/proxy
        - pods
        - services
        - namespaces
        - events
        verbs: ["get", "list", "watch"]
      - api-groups: ["apps"]
        resources:
        - deployments
        - daemonsets
        - statefulsets
        - replicasets
        verbs: ["get", "list", "watch"]
    traits:
      meshmap:
        edges: []
        id: cr-2b3c4d5e-6f7g-8h9i-0j1k-2l3m4n5o6p7q
        meshmodel-metadata:
          capabilities: ""
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: false
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: rectangle
          styleOverrides: '{"border-style":"dashed"}'
          subCategory: Security
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 490
          posY: 170
        whiteboardData:
          style:
            z-index: 11

  New Relic Kubernetes ClusterRoleBinding:
    annotations:
      meshery/component-type: configuration
    type: ClusterRoleBinding
    namespace: ""
    settings:
      metadata:
        name: newrelic-kubernetes
      role-ref:
        api-group: rbac.authorization.k8s.io
        kind: ClusterRole
        name: newrelic-kubernetes
      subjects:
      - kind: ServiceAccount
        name: newrelic-kubernetes
        namespace: observability
    traits:
      meshmap:
        edges: []
        id: crb-3c4d5e6f-7g8h-9i0j-1k2l-3m4n5o6p7q8r
        meshmodel-metadata:
          capabilities: ""
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: false
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: rectangle
          styleOverrides: '{"border-style":"dashed"}'
          subCategory: Security
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 590
          posY: 170
        whiteboardData:
          style:
            z-index: 12

  Postgres Secret:
    annotations:
      meshery/component-type: configuration
    type: Secret
    namespace: default
    settings:
      type: Opaque
      metadata:
        name: postgres-secret
      data:
        postgres-password: "<base64-encoded-password>"
    traits:
      meshmap:
        edges: []
        id: ps-4d5e6f7g-8h9i-0j1k-2l3m-4n5o6p7q8r9s
        meshmodel-metadata:
          capabilities: ""
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: rectangle
          styleOverrides: '{"border-style":"dashed"}'
          subCategory: Configuration
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 70
          posY: 330
        whiteboardData:
          style:
            z-index: 13

  New Relic Secret:
    annotations:
      meshery/component-type: configuration
    type: Secret
    namespace: observability
    settings:
      type: Opaque
      metadata:
        name: newrelic-secret
      data:
        license-key: "<base64-encoded-license-key>"
    traits:
      meshmap:
        edges: []
        id: h8i9j0k1-2l3m-4n5o-6p7q-8r9s0t1u2v3w
        meshmodel-metadata:
          capabilities: ""
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: rectangle
          styleOverrides: '{"border-style":"dashed"}'
          subCategory: Configuration
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 290
          posY: 90
        whiteboardData:
          style:
            z-index: 9

  New Relic Logs Integration:
    annotations:
      meshery/component-type: observability
    type: DaemonSet
    namespace: observability
    settings:
      spec:
        selector:
          match-labels:
            app: newrelic-logging
        template:
          metadata:
            labels:
              app: newrelic-logging
          spec:
            containers:
            - name: newrelic-logging
              image: newrelic/newrelic-fluentbit-output:1.15.0
              securityContext:
                allowPrivilegeEscalation: false
                runAsNonRoot: true
                capabilities:
                  drop:
                  - ALL
              env:
              - name: ENDPOINT
                value: "https://log-api.newrelic.com/log/v1"
              - name: API_KEY
                value-from:
                  secret-key-ref:
                    name: newrelic-secret
                    key: license-key
              volume-mounts:
              - name: var-log
                mount-path: /var/log
            volumes:
            - name: var-log
              host-path:
                path: /var/log
    traits:
      meshmap:
        edges:
        - from: c5a7e8d4-9b2c-4f3a-8e1d-6f4b7a9c2e5d
          to: i9j0k1l2-3m4n-5o6p-7q8r-9s0t1u2v3w4x
        id: i9j0k1l2-3m4n-5o6p-7q8r-9s0t1u2v3w4x
        meshmodel-metadata:
          capabilities: |
            - Log Aggregation
            - Log Forwarding
            - Log Parsing
            - Real-time Log Analysis
          genealogy: parent
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: hexagon
          styleOverrides: ""
          subCategory: Logging
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 50
          posY: 330
        whiteboardData:
          style:
            z-index: 10

  Cache Service:
    annotations:
      meshery/component-type: data
    type: StatefulSet
    namespace: default
    settings:
      spec:
        replicas: 1
        selector:
          match-labels:
            app: redis
        service-name: redis
        template:
          metadata:
            labels:
              app: redis
          spec:
            containers:
            - name: redis
              image: redis:7-alpine
              ports:
              - container-port: 6379
              securityContext:
                allowPrivilegeEscalation: false
                runAsNonRoot: true
                capabilities:
                  drop:
                  - ALL
    traits:
      meshmap:
        edges:
        - from: a1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p
          to: j0k1l2m3-4n5o-6p7q-8r9s-0t1u2v3w4x5y
        id: j0k1l2m3-4n5o-6p7q-8r9s-0t1u2v3w4x5y
        meshmodel-metadata:
          capabilities: ""
          genealogy: parent
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: cylinder
          styleOverrides: '{"background-color":"#DC382D"}'
          subCategory: Cache
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 290
          posY: 330
        whiteboardData:
          style:
            z-index: 11

  New Relic Synthetic Monitor:
    annotations:
      meshery/component-type: observability
    type: ConfigMap
    namespace: observability
    settings:
      metadata:
        name: synthetic-monitor-config
      data:
        monitor-config.json: |
          {
            "monitors": [
              {
                "name": "API Health Check",
                "type": "SIMPLE",
                "frequency": 5,
                "locations": ["AWS_US_EAST_1", "AWS_EU_WEST_1"],
                "uri": "https://api.example.com/health"
              },
              {
                "name": "Browser Test",
                "type": "BROWSER",
                "frequency": 15,
                "locations": ["AWS_US_EAST_1"],
                "script": "navigate to homepage and verify content"
              }
            ]
          }
    traits:
      meshmap:
        edges:
        - from: c5a7e8d4-9b2c-4f3a-8e1d-6f4b7a9c2e5d
          to: k1l2m3n4-5o6p-7q8r-9s0t-1u2v3w4x5y6z
        id: k1l2m3n4-5o6p-7q8r-9s0t-1u2v3w4x5y6z
        meshmodel-metadata:
          capabilities: |
            - Synthetic Monitoring
            - Uptime Monitoring
            - API Testing
            - Browser Testing
          genealogy: ""
          isAnnotation: false
          isCustomResource: false
          isModelAnnotation: "FALSE"
          isNamespaced: true
          logoURL: ""
          model: kubernetes
          modelDisplayName: Kubernetes
          primaryColor: '#326CE5'
          published: true
          secondaryColor: '#7aa1f0'
          shape: round-rectangle
          styleOverrides: ""
          subCategory: Synthetic Monitoring
          svgColor: ""
          svgComplete: ""
          svgWhite: ""
        position:
          posX: 290
          posY: 10
        whiteboardData:
          style:
            z-index: 12
