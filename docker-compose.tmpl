version: '3'
services:
  meshery:
    image: layer5/meshery:{{.ReleaseChannel}}-{{.MesheryVersion}}
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    environment:
      - "PROVIDER_BASE_URLS=https://meshery.layer5.io"
      - "SAAS_BASE_URL=https://meshery.layer5.io"
      - "ADAPTER_URLS=meshery-istio:10000 meshery-linkerd:10001 meshery-consul:10002 meshery-octarine:10003 meshery-nsm:10004 meshery-kuma:10007 meshery-cpx:10008 meshery-osm:10009 meshery-nginx-sm:10010"
      - "EVENT=mesheryLocal"
    volumes:
      - $HOME/.kube:/home/appuser/.kube:ro
    ports:
      - "9081:8080"
  meshery-istio:
    image: layer5/meshery-istio:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10000:10000"
  meshery-linkerd:
    image: layer5/meshery-linkerd:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10001:10001"
  meshery-consul:
    image: layer5/meshery-consul:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10002:10002"
  meshery-octarine:
    image: layer5/meshery-octarine:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10003:10003"
  meshery-nsm:
    image: layer5/meshery-nsm:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10004:10004"
  meshery-kuma:
    image: layer5/meshery-kuma:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10007:10007"
  meshery-cpx:
    image: layer5/meshery-cpx:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10008:10008"
  meshery-osm:
    image: layer5/meshery-osm:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10009:10009"
  meshery-nginx-sm:
    image: layer5/meshery-nginx-sm:{{.ReleaseChannel}}-latest
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    ports:
      - "10010:10010"
  # TODO (kushthedude): Revamp the nighthawk image inclusion approach
  # nighthawk-lg:
  #   image: envoyproxy/nighthawk-dev:latest
  watchtower:
    image: v2tec/watchtower
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --label-enable
volumes:
  meshery-config:
