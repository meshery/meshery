{{/*
  related-discussions.html - Display recent discussion forum topics

  Usage:
    {{< related-discussions tag="meshery" >}}
    {{< related-discussions tag="mesheryctl" >}}

  Parameters:
    - tag: "meshery" (default) or "mesheryctl"

  Replaces Jekyll include:
    {% include related-discussions.html tag="mesheryctl" %}

  Data Dependencies:
    - data/discuss/meshery.json
    - data/discuss/mesheryctl.json

  Issue: https://github.com/meshery/meshery/issues/17244
*/}}
{{- $tag := .Get "tag" | default "meshery" -}}
{{- $dataFile := printf "discuss/%s" $tag -}}
{{- $data := index .Site.Data.discuss $tag -}}

<style>
  .discuss-posts {
    list-style-image: url("/assets/img/meshery/meshery-logo-light.svg");
    line-height: 1.5rem;
  }
  .discuss-post {
    padding: 0.3rem 0.4rem;
  }
  .discuss-post-date {
    color: var(--color-grey-medium);
    font-size: 0.9rem;
  }
  .discuss-post-author {
    color: var(--color-grey-dark);
    font-size: 0.85rem;
  }
</style>

<h2>Recent Discussions with "{{ $tag }}" Tag</h2>

{{- if $data -}}
  {{- $users := $data.users -}}
  {{- $topics := $data.topic_list.topics -}}

  <ul class="discuss-posts">
    {{- range first 10 $topics -}}
      {{- $posterId := index (index .posters 0) "user_id" -}}
      {{- $authorName := "" -}}
      {{- range $users -}}
        {{- if eq .id $posterId -}}
          {{- $authorName = .name -}}
        {{- end -}}
      {{- end -}}
      <li class="discuss-post">
        <span class="discuss-post-date">{{ .created_at | time.Format "Jan 02" }} | </span>
        <a href="https://discuss.meshery.io/t/{{ .slug }}/{{ .id }}">{{ .title }}</a>
        {{- if $authorName -}}
          <span class="discuss-post-author"> by {{ $authorName }}</span>
        {{- end -}}
      </li>
    {{- end -}}
  </ul>
{{- else -}}
  <p>Visit the <a href="https://discuss.meshery.io/tag/{{ $tag }}">{{ $tag }} discussions</a> on the forum.</p>
{{- end -}}
