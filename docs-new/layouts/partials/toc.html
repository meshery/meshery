<div class="content-table-wrapper">
    <div class="content-table">
        <div class="content-table__editable">
            <strong>Tools</strong>
            <a href="{{ .Site.Params.github_repo }}/issues/new?assignees=&labels=area%2Fdocs%2C+framework%2Fhugo&template=documentation.md&title=%5BDocs%5D"
                rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> Create doc issue</a>
            {{ if .File }}
            <a href="{{ .Site.Params.github_repo }}/blob/{{ .Site.Params.github_branch }}/docs-new/content/{{ .File.Path }}"
                rel="noopener" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
            <a href="{{ .Site.Params.github_repo }}/new/{{ .Site.Params.github_branch }}/docs-new/content/{{ .File.Dir }}?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A"
                rel="noopener" target="_blank"><i class="fa fa-plus fa-fw"></i> Create new page</a>
            {{ end }}
        </div>
        <nav id="TableOfContents">
            <strong>Contents</strong>
            <ul>
                <li>
                    <ul id="TOC">
                        <!-- Links will be appended here-->
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<script>
    $(document).ready(function () {

        var toc = $('#TOC');

        // Select each header
        sections = $('.td-content h1');
        $.each(sections, function (idx, v) {
            section = $(v);
            var div_id = $(section).attr('id');
            if (!section.hasClass('noTOC')) {
                var div_text = section.text().split('¶')[0];
                var parent = $("#" + div_id)
                var content = '<li id="link_' + div_id + '" class="md-nav__item"><a class="md-nav__link" href="#' + div_id + '" title="' + div_text + '">' + div_text + '</a></li>';
                $(document).find(toc).append(content);
            }

            // Add section code to subnavigation
            var children = $('<nav class="md-nav"><ul class="md-nav__list"></nav></ul>')
            var contenders = $("#" + div_id).nextUntil("h1");
            $.each(contenders, function (idx, contender) {
                if (!$(contender).hasClass("noTOC") && ($(contender).is('h2') || $(contender).is('h3'))) {
                    var contender_id = $(contender).attr('id');
                    var contender_text = $(contender).text().split('¶')[0];
                    var content = '<li class="md-nav__item"><a class="md-nav__link" href="#' + contender_id + '" title="' + contender_text + '">' + contender_text + '</a></li>';
                    children.append(content);
                }
            })
            $("#link_" + div_id).append(children);
        });
        //added 'selected' tag to the first element of toc
        $('.md-nav__link').first().addClass('selected');

        $(window).scroll(function (e) {
            // Detect how far are we from the top of the page
            let windowTop = $(this).scrollTop();
            // Loop through every navigation menu item
            $('.md-nav__link').each(function (event) {
                if (windowTop >= $($(this).attr('href')).offset().top - 100) {
                    // Remove 'selected' from previously highlighted menu items
                    $('.selected').removeClass('selected');
                    // Highlight the current menu item by adding 'selected' class
                    $(this).addClass('selected');
                }
                if ($(window).scrollTop() + $(window).height() > $(document).document().height() - 10) {
                    $('.selected').removeClass('selected');
                    $(this).addClass('selected');
                }
            });
        })
        // Smooth scroll to target section when clicking on TOC link
        $('a[href^="#"]').on('click', function (event) {
            event.preventDefault();
            var target = $(this.hash);
            if (target.length) {
                $('html, body').animate({
                    scrollTop: target.offset().top - 115
                }, 1000);
            }
        });
    });
</script>
